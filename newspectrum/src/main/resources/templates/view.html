<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${news_article.title}">ë‰´ìŠ¤ ìƒì„¸</title>

    <!-- ì™¸ë¶€ ìŠ¤íƒ€ì¼/ìŠ¤í¬ë¦½íŠ¸ -->
    <link rel="stylesheet" th:href="@{/css/header.css}">

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            margin: 0;
            padding: 0;
        }

        .news-container {
            max-width: 900px;
            margin: 40px auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .news-title {
            font-size: 30px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .news-meta {
            font-size: 14px;
            color: #888;
            margin-bottom: 20px;
        }

        .news-img {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: contain;
        }

        .news-content {
            font-size: 18px;
            line-height: 1.8;
            color: #444;
            white-space: pre-wrap;
            margin-top: 30px;
        }

        .focus-keyword {
            font-weight: bold;
            color: #d9534f;
        }

        .related-news-scroll {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            padding: 10px 20px;
            scroll-behavior: smooth;
            background: linear-gradient(to right, #ffffff, #000000);
            border-radius: 8px;
        }

        .related-news-item {
            flex: 0 0 auto;
            width: 200px;
            margin-right: 20px;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .related-news-item:hover {
            transform: translateY(-5px);
        }

        .related-news-item a {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .related-news-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .related-news-item .title {
            font-size: 14px;
            padding: 10px;
        }

        .section-title {
            font-size: 20px;
            margin-top: 30px;
            margin-bottom: 10px;
            color: #333;
        }

        .ai-summary-list li {
            font-size: 16px;
            margin-bottom: 8px;
            color: #444;
        }

        .ai-image-wrapper {
            text-align: center;
            margin: 15px 0 30px 0;
        }
        .ai-image-wrapper img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        /* í’ˆì§ˆ ì ìˆ˜ ê·¸ë˜í”„ - ë” ì‘ì€ í¬ê¸° */
        .quality-graph-wrapper {
            position: fixed;
            top: 120px;
            right: 20px;
            width: 250px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
            padding: 18px;
            z-index: 1000;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }

        .quality-graph-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
        }

        .graph-section {
            margin-bottom: 18px;
        }

        .graph-section-title {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #555;
            padding: 6px 8px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #6c757d;
        }

        .bar-item {
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 6px;
            border-radius: 6px;
            border: 1px solid transparent;
        }

        .bar-item:hover {
            transform: translateX(3px);
            border-color: #6c757d;
            background: #f8f9ff;
        }

        .bar-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
            font-weight: 500;
            text-transform: capitalize;
        }

        .bar-container {
            background: #f0f0f0;
            border-radius: 8px;
            height: 18px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .bar-fill {
            height: 100%;
            border-radius: 8px;
            transition: width 0.6s ease;
            position: relative;
        }

        .bar-score {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
        }

        /* ì ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ */
        .score-high {
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
        }
        .score-medium {
            background: linear-gradient(90deg, #feca57, #ffd93d);
        }
        .score-low {
            background: linear-gradient(90deg, #48dbfb, #0abde3);
        }

        /* ìƒì„¸ ëª¨ë‹¬ */
        .detail-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .detail-modal-content {
            background-color: white;
            margin: 8% auto;
            padding: 35px;
            border-radius: 15px;
            width: 85%;
            max-width: 550px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .detail-modal-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .detail-modal-score {
            font-size: 20px;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            color: white;
        }

        .detail-modal-description {
            font-size: 16px;
            line-height: 1.7;
            color: #555;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .modal-close {
            color: #aaa;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
            line-height: 1;
        }

        .modal-close:hover {
            color: #ff6b6b;
        }

        .detail-modal-examples {
            background: #fff8e1;
            border: 1px solid #ffcc02;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .detail-modal-examples h4 {
            margin: 0 0 10px 0;
            color: #f57c00;
            font-size: 14px;
        }

        .example-sentence {
            background: #fff3e0;
            padding: 8px 12px;
            border-radius: 6px;
            margin: 8px 0;
            border-left: 3px solid #ff9800;
            font-size: 14px;
            line-height: 1.4;
        }

        .highlight-problem {
            background: #ffebee;
            color: #c62828;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }

        /* ë²”ë¡€ë„ ë” ì‘ê²Œ */
        .score-legend {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .legend-color {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }

        /* ë°˜ì‘í˜• - ë” ì‘ì€ ë¸Œë ˆì´í¬í¬ì¸íŠ¸ */
        @media (max-width: 1300px) {
            .quality-graph-wrapper {
                width: 220px;
                padding: 15px;
            }
        }

        @media (max-width: 1100px) {
            .quality-graph-wrapper {
                display: none;
            }
        }
    </style>
</head>
<body>

<!-- ê³µí†µ ìƒë‹¨ë°” ì‚½ì… -->
<div th:replace="layout/common/header :: header"></div>

<!-- í’ˆì§ˆ ì ìˆ˜ ê·¸ë˜í”„ - ë” ì‘ê³  ê°„ê²°í•œ ë²„ì „ -->
<div class="quality-graph-wrapper" id="qualityGraph">
    <div class="quality-graph-title">ê¸°ì‚¬ í€„ë¦¬í‹° ë¶„ì„</div>

    <!-- ì œëª© í€„ë¦¬í‹° -->
    <div class="graph-section" th:if="${news_article.title_checks != null and !news_article.title_checks.isEmpty()}">
        <div class="graph-section-title">ì œëª© í€„ë¦¬í‹°</div>
        <div th:each="titleCheck, stat : ${news_article.title_checks}"
             th:if="${stat.index < 3}"
             class="bar-item title-check-item"
             th:attr="data-type=${titleCheck.content_check_type}, data-score=${titleCheck.score}"
             onclick="openDetailModal(this, 'title')">
            <div class="bar-label" th:text="${#strings.replace(#strings.replace(titleCheck.content_check_type.name(), 'title_', ''), '_', ' ')}">ê²€ì‚¬ í•­ëª©</div>
            <div class="bar-container">
                <div class="bar-fill"
                     th:classappend="${titleCheck.content_check_type.name() == 'title_normal'} ? (${titleCheck.score >= 0.7} ? 'score-low' : 'score-medium') : (${titleCheck.score >= 0.7} ? 'score-high' : (${titleCheck.score >= 0.4} ? 'score-medium' : 'score-low'))"
                     th:style="|width: ${titleCheck.score * 100}%|">
                    <span class="bar-score" th:text="${#numbers.formatDecimal(titleCheck.score, 1, 3)}">0.000</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ë³¸ë¬¸ í€„ë¦¬í‹° -->
    <div class="graph-section">
        <div class="graph-section-title">ë³¸ë¬¸ í€„ë¦¬í‹°</div>
        <div id="contentChecksContainer">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>
    </div>

    <!-- ê°„ì†Œí™”ëœ ë²”ë¡€ -->
    <div class="score-legend">
        <div class="legend-item">
            <div class="legend-color score-high"></div>
            <span>ë¬¸ì œ</span>
        </div>
        <div class="legend-item">
            <div class="legend-color score-medium"></div>
            <span>ì£¼ì˜</span>
        </div>
        <div class="legend-item">
            <div class="legend-color score-low"></div>
            <span>ì–‘í˜¸</span>
        </div>
    </div>
</div>

<!-- ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
<div id="detailModal" class="detail-modal">
    <div class="detail-modal-content">
        <span class="modal-close" onclick="closeDetailModal()">&times;</span>
        <div class="detail-modal-title" id="detailTitle">ê²€ì‚¬ ìƒì„¸ ì •ë³´</div>
        <div class="detail-modal-score" id="detailScore">ì ìˆ˜: 0.00</div>
        <div class="detail-modal-description" id="detailDescription">ìƒì„¸ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
        <div class="detail-modal-examples" id="detailKeywords" style="display: none;">
            <h4>ğŸ” ê²€ì‚¬ ëŒ€ìƒ ë¬¸ì¥/í‚¤ì›Œë“œ</h4>
            <div id="keywordContent"></div>
        </div>
    </div>
</div>

<!-- ë‰´ìŠ¤ ê¸°ì‚¬ ì»¨í…Œì´ë„ˆ -->
<div class="news-container">
    <div class="news-title" th:text="${news_article.title}">ê¸°ì‚¬ ì œëª©</div>
    <div class="news-meta">
        <span th:text="${news_article.media}">ì–¸ë¡ ì‚¬</span> |
        <span th:text="${#temporals.format(news_article.createdDate, 'yyyy-MM-dd HH:mm')}">ë‚ ì§œ</span>
    </div>

    <!-- í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ ê°•ì¡° ì¶œë ¥ -->
    <div class="news-meta" style="margin-top: 5px;">
      <span th:each="kw, stat : ${keyword_items}" th:if="${stat.index < 5}"
            th:text="|#${kw.keyword} |"
            style="font-weight: bold; color: #555;">
        #í‚¤ì›Œë“œ
      </span>
    </div>

    <!-- AI ë‰´ìŠ¤ ìš”ì•½ -->
    <div class="section-title">ğŸ§  AI ë‰´ìŠ¤ ìš”ì•½</div>
    <ol class="ai-summary-list">
        <li th:each="line : ${summaryLines}" th:text="${line}">ìš”ì•½ ë¬¸ì¥</li>
    </ol>
    <div class="ai-image-wrapper">
        <img th:src="@{'/img/' + ${news_article.comics_url}}" alt="AI ìš”ì•½ ì´ë¯¸ì§€">
    </div>

    <!-- ë‰´ìŠ¤ ì´ë¯¸ì§€ ì¶”ê°€ -->
    <img class="news-img" th:src="${news_article.img_url}" alt="ë‰´ìŠ¤ ì´ë¯¸ì§€">

    <div class="news-content" th:utext="${news_article.content}">
        <!-- ë³¸ë¬¸ ë‚´ìš© -->
    </div>

    <!-- ê°™ì´ ë³´ë©´ ì¢‹ì€ ê¸°ì‚¬ -->
    <div class="section-title">ì—°ê´€ ë‰´ìŠ¤ ì¶”ì²œ</div>
    <div class="related-news-scroll" onwheel="scrollHorizontally(event)">
        <div class="related-news-item" th:each="related : ${related_news_articles}"
             th:href="@{/view/{id}(id=${related.news_article.id})}">
            <a th:href="@{/view/{id}(id=${related.news_article.id})}">
                <img th:src="${related.news_article.img_url}" alt="ê´€ë ¨ ë‰´ìŠ¤ ì´ë¯¸ì§€">
                <div class="title" th:text="${related.news_article.title}">ê´€ë ¨ ë‰´ìŠ¤ ì œëª©</div>
            </a>
        </div>
    </div>
</div>

<!-- ìˆ¨ê²¨ì§„ ë°ì´í„° ì €ì¥ì†Œ (í‚¤ì›Œë“œ ì •ë³´ë„ í¬í•¨) -->
<div id="allContentChecksData" style="display: none;">
    <div th:each="entry : ${news_article.content_checks}"
         th:attr="data-keyword=${entry.key}">
        <div th:each="check : ${entry.value}"
             th:attr="data-type=${check.content_check_type}, data-score=${check.score}, data-keyword=${check.keyword}">
        </div>
    </div>
</div>

<!-- Title checks í‚¤ì›Œë“œ ì •ë³´ë„ ì €ì¥ -->
<div id="titleChecksData" style="display: none;">
    <div th:each="titleCheck : ${news_article.title_checks}"
         th:attr="data-type=${titleCheck.content_check_type}, data-score=${titleCheck.score}, data-keyword=${titleCheck.keyword}">
    </div>
</div>

<script>
    // ìŠ¤í¬ë¡¤ ë”°ë¼ë‹¤ë‹ˆëŠ” ê·¸ë˜í”„ ìœ„ì ¯
    const qualityGraph = document.getElementById('qualityGraph');
    let isScrolling = false;

    window.addEventListener('scroll', () => {
        if (!isScrolling) {
            window.requestAnimationFrame(() => {
                const scrollY = window.scrollY;
                const newTop = 120 + (scrollY * 0.05);
                qualityGraph.style.top = `${newTop}px`;
                isScrolling = false;
            });
        }
        isScrolling = true;
    });

    // ëª¨ë“  Content Checks ë°ì´í„° ì½ê¸°
    function getAllContentChecksData() {
        const dataContainer = document.getElementById('allContentChecksData');
        const allData = [];

        const keywordDivs = dataContainer.querySelectorAll('[data-keyword]');

        keywordDivs.forEach(keywordDiv => {
            const keyword = keywordDiv.getAttribute('data-keyword');

            const checkDivs = keywordDiv.querySelectorAll('[data-type][data-score]');
            checkDivs.forEach(checkDiv => {
                const type = checkDiv.getAttribute('data-type');
                const score = parseFloat(checkDiv.getAttribute('data-score'));

                allData.push({
                    keyword: keyword,
                    type: type,
                    score: score
                });
            });
        });

        return allData;
    }

    // Content Checks íƒ€ì…ë³„ í‰ê·  ê³„ì‚° (content_ íƒ€ì…ë§Œ í•„í„°ë§)
    function calculateTypeAverages() {
        const allData = getAllContentChecksData();
        const typeGroups = {};

        // content_ë¡œ ì‹œì‘í•˜ëŠ” íƒ€ì…ë§Œ ì²˜ë¦¬
        allData.forEach(item => {
            // title_ë¡œ ì‹œì‘í•˜ëŠ” íƒ€ì…ì€ ì œì™¸
            if (item.type.startsWith('title_')) {
                return;
            }

            if (!typeGroups[item.type]) {
                typeGroups[item.type] = [];
            }
            typeGroups[item.type].push(item.score);
        });

        // íƒ€ì…ë³„ í‰ê·  ê³„ì‚°
        const averages = [];
        for (const type in typeGroups) {
            const scores = typeGroups[type];
            const average = scores.reduce((sum, score) => sum + score, 0) / scores.length;

            averages.push({
                type: type,
                average: average,
                count: scores.length
            });
        }

        // í‰ê·  ì ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
        averages.sort((a, b) => b.average - a.average);

        return averages;
    }

    // Content Checks ê·¸ë˜í”„ ë Œë”ë§ (normal ê°’ ì²˜ë¦¬ ìˆ˜ì •)
    function renderContentChecks() {
        const averages = calculateTypeAverages();
        const top3 = averages.slice(0, 3);
        const container = document.getElementById('contentChecksContainer');

        container.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© í´ë¦¬ì–´

        top3.forEach(item => {
            // íƒ€ì…ëª…ì—ì„œ content_ ì œê±°í•˜ê³  _ ë¥¼ ê³µë°±ìœ¼ë¡œ ë³€ê²½
            const displayName = item.type.replace('content_', '').replace(/_/g, ' ');

            // normal íƒ€ì…ì˜ ê²½ìš° ì ìˆ˜ í•´ì„ì„ ë°˜ëŒ€ë¡œ (ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ)
            let colorClass = 'score-low';
            if (item.type === 'content_normal') {
                // normalì€ ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ
                if (item.average >= 0.7) {
                    colorClass = 'score-low'; // ì–‘í˜¸
                } else if (item.average >= 0.4) {
                    colorClass = 'score-medium'; // ì£¼ì˜
                } else {
                    colorClass = 'score-high'; // ë¬¸ì œ
                }
            } else {
                // ë‹¤ë¥¸ íƒ€ì…ë“¤ì€ ë†’ì„ìˆ˜ë¡ ë¬¸ì œ
                if (item.average >= 0.7) {
                    colorClass = 'score-high'; // ë¬¸ì œ
                } else if (item.average >= 0.4) {
                    colorClass = 'score-medium'; // ì£¼ì˜
                } else {
                    colorClass = 'score-low'; // ì–‘í˜¸
                }
            }

            const barHtml = `
                <div class="bar-item content-check-item"
                     data-type="${item.type}"
                     data-score="${item.average}"
                     data-count="${item.count}"
                     onclick="openDetailModal(this, 'content')">
                    <div class="bar-label">${displayName}</div>
                    <div class="bar-container">
                        <div class="bar-fill ${colorClass}" style="width: ${item.average * 100}%">
                            <span class="bar-score">${item.average.toFixed(3)}</span>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML += barHtml;
        });
    }

    // ê²€ì‚¬ íƒ€ì…ë³„ ìƒì„¸ ì„¤ëª… (ëª¨ë“  íƒ€ì… í¬í•¨)
    const checkDescriptions = {
        // ì œëª© ê´€ë ¨
        'title_normal': {
            title: 'ì¼ë°˜ì  í‘œí˜„ ê²€ì‚¬',
            description: 'ì œëª©ì´ ê³¼ë„í•˜ê²Œ ìê·¹ì ì´ê±°ë‚˜ ì„ ì •ì ì´ì§€ ì•Šê³ , ì¼ë°˜ì ì´ê³  ê°ê´€ì ì¸ í‘œí˜„ì„ ì‚¬ìš©í•˜ëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'title_hidden_1': {
            title: 'ìˆ¨ê²¨ì§„ í¸í–¥ 1ì°¨ ê²€ì‚¬',
            description: 'ì œëª©ì— ë“œëŸ¬ë‚˜ì§€ ì•Šì€ í¸í–¥ì´ë‚˜ íŠ¹ì • ê´€ì ì„ ì•”ì‹œí•˜ëŠ” í‘œí˜„ì´ ìˆëŠ”ì§€ 1ì°¨ì ìœ¼ë¡œ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'title_hidden_2': {
            title: 'ìˆ¨ê²¨ì§„ í¸í–¥ 2ì°¨ ê²€ì‚¬',
            description: 'ì œëª©ì˜ ìˆ¨ê²¨ì§„ í¸í–¥ì„ ë” ê¹Šì´ ìˆê²Œ ë¶„ì„í•˜ëŠ” 2ì°¨ ê²€ì‚¬ì…ë‹ˆë‹¤.'
        },
        'title_intentional_distortion': {
            title: 'ì˜ë„ì  ì™œê³¡ ê²€ì‚¬',
            description: 'ì œëª©ì´ ì‚¬ì‹¤ì„ ì˜ë„ì ìœ¼ë¡œ ì™œê³¡í•˜ê±°ë‚˜ ì˜¤í•´ë¥¼ ë¶ˆëŸ¬ì¼ìœ¼í‚¬ ìˆ˜ ìˆëŠ” í‘œí˜„ì„ ì‚¬ìš©í•˜ëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'title_over_representation': {
            title: 'ê³¼ì¥ í‘œí˜„ ê²€ì‚¬',
            description: 'ì œëª©ì— ê³¼ì¥ë˜ê±°ë‚˜ ê³¼ë„í•œ í‘œí˜„ì´ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },

        // ë‚´ìš© ê´€ë ¨
        'content_normal': {
            title: 'ë‚´ìš© ê°ê´€ì„± ê²€ì‚¬',
            description: 'ê¸°ì‚¬ ë‚´ìš©ì´ ê°ê´€ì ì´ê³  ê· í˜• ì¡íŒ ì‹œê°ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'content_intentional_distortion': {
            title: 'ë‚´ìš© ì™œê³¡ ê²€ì‚¬',
            description: 'ê¸°ì‚¬ ë‚´ìš©ì— ì˜ë„ì ì¸ ì‚¬ì‹¤ ì™œê³¡ì´ë‚˜ ì˜¤í•´ë¥¼ ë¶ˆëŸ¬ì¼ìœ¼í‚¤ëŠ” í‘œí˜„ì´ ìˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'content_advertisement_1': {
            title: 'ê´‘ê³ ì„± ë‚´ìš© 1ì°¨ ê²€ì‚¬',
            description: 'ê¸°ì‚¬ ë‚´ìš©ì— ê´‘ê³ ë‚˜ í™ë³´ ëª©ì ì˜ ë‚´ìš©ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ 1ì°¨ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'content_advertisement_2': {
            title: 'ê´‘ê³ ì„± ë‚´ìš© 2ì°¨ ê²€ì‚¬',
            description: 'ê¸°ì‚¬ ë‚´ìš©ì— ìˆ¨ê²¨ì§„ ê´‘ê³ ë‚˜ ê°„ì ‘ í™ë³´ ìš”ì†Œê°€ ìˆëŠ”ì§€ 2ì°¨ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'content_advertisement_3': {
            title: 'ê´‘ê³ ì„± ë‚´ìš© 3ì°¨ ê²€ì‚¬',
            description: 'ê¸°ì‚¬ ë‚´ìš©ì— ë¯¸ë¬˜í•œ ê´‘ê³ ì„± ìš”ì†Œë‚˜ ë¸Œëœë“œ ë…¸ì¶œì´ ìˆëŠ”ì§€ 3ì°¨ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'title_sensation': {
            title: 'ì„ ì •ì  í‘œí˜„ ê²€ì‚¬',
            description: 'ì œëª©ì´ë‚˜ ë‚´ìš©ì— ë…ìì˜ ê´€ì‹¬ì„ ëŒê¸° ìœ„í•œ ì„ ì •ì ì´ê±°ë‚˜ ìê·¹ì ì¸ í‘œí˜„ì´ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'title_slang': {
            title: 'ë¹„ì†ì–´/ì€ì–´ ê²€ì‚¬',
            description: 'ì œëª©ì´ë‚˜ ë‚´ìš©ì— ë¶€ì ì ˆí•œ ë¹„ì†ì–´, ì€ì–´, ë˜ëŠ” ê²©ì‹ì— ë§ì§€ ì•ŠëŠ” í‘œí˜„ì´ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        }
    };

    // í•´ë‹¹ íƒ€ì…ì˜ ì‹¤ì œ í‚¤ì›Œë“œë“¤ ì°¾ê¸°
    function findActualKeywords(checkType, type) {
        const keywords = [];

        if (type === 'title') {
            // Title checksì—ì„œ í•´ë‹¹ íƒ€ì…ì˜ í‚¤ì›Œë“œ ì°¾ê¸°
            const titleDataContainer = document.getElementById('titleChecksData');
            const titleElements = titleDataContainer.querySelectorAll(`[data-type="${checkType}"]`);

            titleElements.forEach(element => {
                const keyword = element.getAttribute('data-keyword');
                const score = element.getAttribute('data-score');
                if (keyword && keyword.trim() !== '') {
                    keywords.push({
                        text: keyword,
                        score: parseFloat(score)
                    });
                }
            });
        } else if (type === 'content') {
            // Content checksì—ì„œ í•´ë‹¹ íƒ€ì…ì˜ í‚¤ì›Œë“œë“¤ ì°¾ê¸°
            const contentDataContainer = document.getElementById('allContentChecksData');
            const contentElements = contentDataContainer.querySelectorAll(`[data-type="${checkType}"]`);

            contentElements.forEach(element => {
                const keyword = element.getAttribute('data-keyword');
                const score = element.getAttribute('data-score');
                if (keyword && keyword.trim() !== '') {
                    keywords.push({
                        text: keyword,
                        score: parseFloat(score)
                    });
                }
            });
        }

        // ì ìˆ˜ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬
        keywords.sort((a, b) => b.score - a.score);

        return keywords;
    }

    // ëª¨ë‹¬ ì—´ê¸° (ì‹¤ì œ í‚¤ì›Œë“œ í‘œì‹œ)
    function openDetailModal(element, type) {
        const checkType = element.getAttribute('data-type');
        const score = parseFloat(element.getAttribute('data-score'));
        const count = element.getAttribute('data-count');

        const modal = document.getElementById('detailModal');
        const title = document.getElementById('detailTitle');
        const scoreElement = document.getElementById('detailScore');
        const description = document.getElementById('detailDescription');
        const keywordsDiv = document.getElementById('detailKeywords');
        const keywordContent = document.getElementById('keywordContent');

        const checkInfo = checkDescriptions[checkType] || {
            title: 'ê²€ì‚¬ í•­ëª©',
            description: 'í•´ë‹¹ ê²€ì‚¬ í•­ëª©ì— ëŒ€í•œ ìƒì„¸ ì„¤ëª…ì…ë‹ˆë‹¤.'
        };

        title.textContent = `${type === 'title' ? 'ì œëª©' : 'ë‚´ìš©'} - ${checkInfo.title}`;

        if (type === 'content' && count) {
            scoreElement.textContent = `í‰ê·  ìœ„í—˜ë„: ${score.toFixed(6)} (${count}ê°œ ë°ì´í„°)`;
        } else {
            scoreElement.textContent = `ìœ„í—˜ë„ ì ìˆ˜: ${score.toFixed(6)}`;
        }

        // ì ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ì„¤ì •
        const isNormalType = checkType.includes('normal');
        if (isNormalType) {
            if (score >= 0.7) {
                scoreElement.style.background = 'linear-gradient(135deg, #48dbfb, #0abde3)';
            } else if (score >= 0.4) {
                scoreElement.style.background = 'linear-gradient(135deg, #feca57, #ffd93d)';
            } else {
                scoreElement.style.background = 'linear-gradient(135deg, #ff6b6b, #ff8e8e)';
            }
        } else {
            if (score >= 0.7) {
                scoreElement.style.background = 'linear-gradient(135deg, #ff6b6b, #ff8e8e)';
            } else if (score >= 0.4) {
                scoreElement.style.background = 'linear-gradient(135deg, #feca57, #ffd93d)';
            } else {
                scoreElement.style.background = 'linear-gradient(135deg, #48dbfb, #0abde3)';
            }
        }

        // ì„¤ëª…ê³¼ í•´ì„ ì¶”ê°€
        let interpretation = '';
        if (isNormalType) {
            if (score >= 0.7) {
                interpretation = '<br><br><strong style="color: #48dbfb;">âœ… ìš°ìˆ˜: ë§¤ìš° ì–‘í˜¸í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.</strong><br>ì´ í•­ëª©ì—ì„œ ë†’ì€ ì ìˆ˜ê°€ ë‚˜ì˜¨ ê²ƒì€ ê¸°ì‚¬ì˜ í’ˆì§ˆì´ ìš°ìˆ˜í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.';
            } else if (score >= 0.4) {
                interpretation = '<br><br><strong style="color: #feca57;">âš ï¸ ë³´í†µ: ê°œì„  ì—¬ì§€ê°€ ìˆëŠ” ìˆ˜ì¤€ì…ë‹ˆë‹¤.</strong><br>ê¸°ë³¸ì ì¸ í’ˆì§ˆì€ ê°–ì¶”ê³  ìˆì§€ë§Œ ë” ë‚˜ì€ í’ˆì§ˆì„ ìœ„í•´ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.';
            } else {
                interpretation = '<br><br><strong style="color: #ff6b6b;">ğŸš¨ ì£¼ì˜: í’ˆì§ˆ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.</strong><br>ì´ í•­ëª©ì—ì„œ ë‚®ì€ ì ìˆ˜ê°€ ë‚˜ì˜¨ ê²ƒì€ í’ˆì§ˆ í–¥ìƒì´ í•„ìš”í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.';
            }
        } else {
            if (score >= 0.7) {
                interpretation = '<br><br><strong style="color: #ff6b6b;">ğŸš¨ ìœ„í—˜: ì¦‰ì‹œ ê²€í† ê°€ í•„ìš”í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.</strong><br>ì´ í•­ëª©ì—ì„œ ë†’ì€ ì ìˆ˜ê°€ ë‚˜ì™”ë‹¤ëŠ” ê²ƒì€ í•´ë‹¹ ë¶€ë¶„ì— ë¬¸ì œê°€ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.';
            } else if (score >= 0.4) {
                interpretation = '<br><br><strong style="color: #feca57;">âš ï¸ ì£¼ì˜: ê°œì„ ì´ ê¶Œì¥ë˜ëŠ” ìˆ˜ì¤€ì…ë‹ˆë‹¤.</strong><br>ì™„ì „íˆ ë¬¸ì œê°€ ìˆë‹¤ê³  ë³¼ ìˆ˜ëŠ” ì—†ì§€ë§Œ, ë” ë‚˜ì€ í’ˆì§ˆì„ ìœ„í•´ ê²€í† í•´ë³¼ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.';
            } else {
                interpretation = '<br><br><strong style="color: #48dbfb;">âœ… ì–‘í˜¸: í’ˆì§ˆì´ ìš°ìˆ˜í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.</strong><br>ì´ í•­ëª©ì—ì„œëŠ” íŠ¹ë³„í•œ ë¬¸ì œê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
            }
        }

        description.innerHTML = checkInfo.description + interpretation;

        // ì‹¤ì œ í‚¤ì›Œë“œë“¤ í‘œì‹œ
        const actualKeywords = findActualKeywords(checkType, type);
        if (actualKeywords.length > 0) {
            let keywordHtml = '';

            if (type === 'content') {
                keywordHtml += `<div style="font-size: 12px; color: #666; margin-bottom: 10px;">ì´ ${actualKeywords.length}ê°œì˜ ë¬¸ì¥ì—ì„œ ê²€ì‚¬ë¨</div>`;
            }

            // ìƒìœ„ 5ê°œë§Œ í‘œì‹œ (ë„ˆë¬´ ë§ìœ¼ë©´ í™”ë©´ì´ ë³µì¡í•´ì§)
            const displayKeywords = actualKeywords.slice(0, 5);

            displayKeywords.forEach((item, index) => {
                const shortText = item.text.length > 100 ?
                    item.text.substring(0, 100) + '...' :
                    item.text;

                keywordHtml += `
                    <div class="example-sentence">
                        <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
                            ì ìˆ˜: ${item.score.toFixed(6)}
                        </div>
                        <div style="line-height: 1.4;">
                            "${shortText}"
                        </div>
                    </div>
                `;
            });

            if (actualKeywords.length > 5) {
                keywordHtml += `<div style="font-size: 12px; color: #999; text-align: center; margin-top: 10px;">ì™¸ ${actualKeywords.length - 5}ê°œ ë”...</div>`;
            }

            keywordContent.innerHTML = keywordHtml;
            keywordsDiv.style.display = 'block';
        } else {
            keywordsDiv.style.display = 'none';
        }

        modal.style.display = 'block';
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeDetailModal() {
        document.getElementById('detailModal').style.display = 'none';
    }

    // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    window.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            closeDetailModal();
        }
    });

    // ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        const detailModal = document.getElementById("detailModal");
        if (event.target === detailModal) {
            closeDetailModal();
        }
    }

    // ê°€ë¡œ ìŠ¤í¬ë¡¤ í•¨ìˆ˜
    function scrollHorizontally(event) {
        event.preventDefault();
        event.currentTarget.scrollLeft += event.deltaY;
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ Content Checks ë Œë”ë§
    window.addEventListener('load', function() {
        console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ìµœì¢… ë²„ì „');

        // Content Checks ê·¸ë˜í”„ ìƒì„±
        renderContentChecks();

        // ê·¸ë˜í”„ ì• ë‹ˆë©”ì´ì…˜
        setTimeout(() => {
            const barFills = document.querySelectorAll('.bar-fill');
            barFills.forEach((bar, index) => {
                setTimeout(() => {
                    bar.style.width = bar.style.width; // ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°
                }, index * 200);
            });
        }, 100);
    });
</script>

</body>
</html>