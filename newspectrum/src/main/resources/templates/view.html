<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${news_article.title}">ë‰´ìŠ¤ ìƒì„¸</title>

    <!-- ì™¸ë¶€ ìŠ¤íƒ€ì¼/ìŠ¤í¬ë¦½íŠ¸ -->
    <link rel="stylesheet" th:href="@{/css/header.css}">

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            margin: 0;
            padding: 0;
        }

        .news-container {
            max-width: 900px;
            margin: 40px auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .news-title {
            font-size: 30px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .news-meta {
            font-size: 14px;
            color: #888;
            margin-bottom: 20px;
        }

        .news-img {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: contain;
        }

        .news-content {
            font-size: 18px;
            line-height: 1.8;
            color: #444;
            white-space: pre-wrap;
            margin-top: 30px;
        }

        .focus-keyword {
            font-weight: bold;
            color: #d9534f;
        }

        .related-news-scroll {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            padding: 10px 20px;
            scroll-behavior: smooth;
            background: linear-gradient(to right, #ffffff, #000000);
            border-radius: 8px;
        }

        .related-news-item {
            flex: 0 0 auto;
            width: 200px;
            margin-right: 20px;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .related-news-item:hover {
            transform: translateY(-5px);
        }

        .related-news-item a {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .related-news-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .related-news-item .title {
            font-size: 14px;
            padding: 10px;
        }

        .section-title {
            font-size: 20px;
            margin-top: 30px;
            margin-bottom: 10px;
            color: #333;
        }

        .ai-summary-list li {
            font-size: 16px;
            margin-bottom: 8px;
            color: #444;
        }

        .ai-image-wrapper {
            text-align: center;
            margin: 15px 0 30px 0;
        }
        .ai-image-wrapper img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        /* í’ˆì§ˆ ì ìˆ˜ ê·¸ë˜í”„ - ë” ì‘ì€ í¬ê¸° */
        .quality-graph-wrapper {
            position: fixed;
            top: 120px;
            right: 20px;
            width: 250px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
            padding: 18px;
            z-index: 1000;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }

        .quality-graph-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
        }

        .graph-section {
            margin-bottom: 18px;
        }

        .graph-section-title {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #555;
            padding: 6px 8px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #6c757d;
        }

        .bar-item {
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 6px;
            border-radius: 6px;
            border: 1px solid transparent;
        }

        .bar-item:hover {
            transform: translateX(3px);
            border-color: #6c757d;
            background: #f8f9ff;
        }

        .bar-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 3px;
            font-weight: 500;
            text-transform: capitalize;
        }

        .bar-container {
            background: #f0f0f0;
            border-radius: 8px;
            height: 18px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .bar-fill {
            height: 100%;
            border-radius: 8px;
            transition: width 0.6s ease;
            position: relative;
        }

        .bar-score {
            position: absolute;
            right: 6px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.3);
        }

        /* ì ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ */
        .score-high {
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
        }
        .score-medium {
            background: linear-gradient(90deg, #feca57, #ffd93d);
        }
        .score-low {
            background: linear-gradient(90deg, #48dbfb, #0abde3);
        }

        /* ìƒì„¸ ëª¨ë‹¬ */
        .detail-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .detail-modal-content {
            background-color: white;
            margin: 8% auto;
            padding: 35px;
            border-radius: 15px;
            width: 85%;
            max-width: 550px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .detail-modal-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .detail-modal-score {
            font-size: 20px;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            color: white;
        }

        .detail-modal-description {
            font-size: 16px;
            line-height: 1.7;
            color: #555;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .modal-close {
            color: #aaa;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
            line-height: 1;
        }

        .modal-close:hover {
            color: #ff6b6b;
        }

        .detail-modal-examples {
            background: #fff8e1;
            border: 1px solid #ffcc02;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .detail-modal-examples h4 {
            margin: 0 0 10px 0;
            color: #f57c00;
            font-size: 14px;
            position: sticky;
            top: 0;
            background: #fff8e1;
            padding-bottom: 5px;
            z-index: 10;
        }

        .example-sentence {
            background: #fff3e0;
            padding: 8px 12px;
            border-radius: 6px;
            margin: 8px 0;
            border-left: 3px solid #ff9800;
            font-size: 14px;
            line-height: 1.4;
        }

        .problem-sentence {
            background: #ffebee;
            border-left: 3px solid #f44336;
        }

        .highlight-problem {
            background: #ffebee;
            color: #c62828;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }

        /* ë²”ë¡€ë„ ë” ì‘ê²Œ */
        .score-legend {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .legend-color {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }

        .type-group {
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }

        .type-group-header {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 12px 15px;
            font-weight: bold;
            font-size: 16px;
        }

        .type-group-content {
            padding: 15px;
            background: #fff;
        }

        .problem-sentence-item {
            background: #fff3e0;
            padding: 12px 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #ff9800;
            transition: all 0.3s ease;
        }

        .problem-sentence-item:hover {
            background: #ffebee;
            transform: translateX(3px);
        }

        .sentence-score {
            font-size: 12px;
            color: #c62828;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .sentence-text {
            line-height: 1.5;
            color: #333;
        }

        /* ë°˜ì‘í˜• - ë” ì‘ì€ ë¸Œë ˆì´í¬í¬ì¸íŠ¸ */
        @media (max-width: 1300px) {
            .quality-graph-wrapper {
                width: 220px;
                padding: 15px;
            }
        }

        @media (max-width: 1100px) {
            .quality-graph-wrapper {
                display: none;
            }
        }
    </style>
</head>
<body>

<!-- ê³µí†µ ìƒë‹¨ë°” ì‚½ì… -->
<div th:replace="layout/common/header :: header"></div>

<!-- í’ˆì§ˆ ì ìˆ˜ ê·¸ë˜í”„ - ë” ì‘ê³  ê°„ê²°í•œ ë²„ì „ -->
<div class="quality-graph-wrapper" id="qualityGraph">
    <div class="quality-graph-title">ê¸°ì‚¬ í€„ë¦¬í‹° ë¶„ì„</div>

    <!-- ì œëª© í€„ë¦¬í‹° -->
    <div class="graph-section" th:if="${news_article.title_checks != null and !news_article.title_checks.isEmpty()}">
        <div class="graph-section-title">ì œëª© í€„ë¦¬í‹°</div>
        <div th:each="titleCheck, stat : ${news_article.title_checks}"
             th:if="${stat.index < 3}"
             class="bar-item title-check-item"
             th:attr="data-type=${titleCheck.content_check_type}, data-score=${titleCheck.score}"
             onclick="openDetailModal(this, 'title')">
            <div class="bar-label" th:text="${titleCheck.content_check_type.name() == 'title_normal'} ? 'ì •ìƒ í‘œí˜„' :
                                            (${titleCheck.content_check_type.name() == 'title_hidden_1'} ? 'ì˜ë¬¸ ìœ ë°œ(ë¶€í˜¸)' :
                                            (${titleCheck.content_check_type.name() == 'title_hidden_2'} ? 'ì˜ë¬¸ ìœ ë°œ(ì€ë‹‰)' :
                                            (${titleCheck.content_check_type.name() == 'title_sensation'} ? 'ì„ ì • í‘œí˜„' :
                                            (${titleCheck.content_check_type.name() == 'title_slang'} ? 'ì†ì–´/ì¤„ì„ë§ ì‚¬ìš©' :
                                            (${titleCheck.content_check_type.name() == 'title_over_representation'} ? 'ê³¼ëŒ€ í‘œí˜„' :
                                            (${titleCheck.content_check_type.name() == 'title_intentional_distortion'} ? 'ì£¼ì–´ ì˜ë„ì  ì™œê³¡' : ${titleCheck.content_check_type.name()}))))))">ê²€ì‚¬ í•­ëª©</div>
            <div class="bar-container">
                <div class="bar-fill"
                     th:classappend="${titleCheck.content_check_type.name() == 'title_normal'} ? (${titleCheck.score >= 0.7} ? 'score-low' : 'score-medium') : (${titleCheck.score >= 0.7} ? 'score-high' : (${titleCheck.score >= 0.4} ? 'score-medium' : 'score-low'))"
                     th:style="|width: ${titleCheck.score * 100}%|">
                    <span class="bar-score" th:text="${#numbers.formatDecimal(titleCheck.score, 1, 3)}">0.000</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ë³¸ë¬¸ í€„ë¦¬í‹° -->
    <div class="graph-section">
        <div class="graph-section-title">ë³¸ë¬¸ í€„ë¦¬í‹°</div>

        <!-- ë„ë„› ì°¨íŠ¸ ì˜ì—­ (í´ë¦­ ê°€ëŠ¥) -->
        <div style="margin-top: 15px; text-align: center; cursor: pointer;" onclick="openContentQualityModal()">
            <canvas id="problemRatioChart" width="180" height="180" style="max-width: 180px; max-height: 180px; border: none;"></canvas>
            <div id="chartLegend" style="font-size: 10px; margin-top: 8px;">
                <!-- ë²”ë¡€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            <div style="font-size: 11px; color: #666; margin-top: 5px;">í´ë¦­í•˜ì—¬ ìƒì„¸ ë¶„ì„ ë³´ê¸°</div>
        </div>
    </div>

    <!-- ê°„ì†Œí™”ëœ ë²”ë¡€ -->
    <div class="score-legend">
        <div class="legend-item">
            <div class="legend-color score-high"></div>
            <span>ë¬¸ì œ</span>
        </div>
        <div class="legend-item">
            <div class="legend-color score-medium"></div>
            <span>ì£¼ì˜</span>
        </div>
        <div class="legend-item">
            <div class="legend-color score-low"></div>
            <span>ì–‘í˜¸</span>
        </div>
    </div>
</div>

<!-- ì œëª© ê²€ì‚¬ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ -->
<div id="detailModal" class="detail-modal">
    <div class="detail-modal-content">
        <span class="modal-close" onclick="closeDetailModal()">&times;</span>
        <div class="detail-modal-title" id="detailTitle">ê²€ì‚¬ ìƒì„¸ ì •ë³´</div>
        <div class="detail-modal-score" id="detailScore">ì ìˆ˜: 0.00</div>
        <div class="detail-modal-description" id="detailDescription">ìƒì„¸ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
        <div class="detail-modal-examples" id="detailKeywords" style="display: none;">
            <h4>ğŸ” ê²€ì‚¬ ëŒ€ìƒ ë¬¸ì¥/í‚¤ì›Œë“œ</h4>
            <div id="keywordContent"></div>
        </div>
    </div>
</div>

<!-- ë³¸ë¬¸ í€„ë¦¬í‹° ë¶„ì„ ëª¨ë‹¬ -->
<div id="contentQualityModal" class="detail-modal">
    <div class="detail-modal-content" style="max-width: 700px; width: 90%;">
        <span class="modal-close" onclick="closeContentQualityModal()">&times;</span>
        <div class="detail-modal-title">ë³¸ë¬¸ í€„ë¦¬í‹° ë¶„ì„</div>

        <div id="contentQualityResults" style="max-height: 500px; overflow-y: auto;">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>
    </div>
</div>

<!-- ë‰´ìŠ¤ ê¸°ì‚¬ ì»¨í…Œì´ë„ˆ -->
<div class="news-container">
    <div class="news-title" th:text="${news_article.title}">ê¸°ì‚¬ ì œëª©</div>
    <div class="news-meta">
        <span th:text="${news_article.media}">ì–¸ë¡ ì‚¬</span> |
        <span th:text="${#temporals.format(news_article.createdDate, 'yyyy-MM-dd HH:mm')}">ë‚ ì§œ</span>
    </div>

    <!-- í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ ê°•ì¡° ì¶œë ¥ -->
    <div class="news-meta" style="margin-top: 5px;">
      <span th:each="kw, stat : ${keyword_items}" th:if="${stat.index < 5}"
            th:text="|#${kw.keyword} |"
            style="font-weight: bold; color: #555;">
        #í‚¤ì›Œë“œ
      </span>
    </div>

    <!-- AI ë‰´ìŠ¤ ìš”ì•½ - 2ì—´ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ë³€ê²½ -->
    <div class="section-title">ğŸ§  AI ë‰´ìŠ¤ ìš”ì•½</div>
    <div style="display: flex; gap: 30px; margin-bottom: 30px;">
        <!-- ì™¼ìª½: AI ì´ë¯¸ì§€ -->
        <div style="flex: 1;">
            <div class="ai-image-wrapper" style="margin: 0;">
                <img th:src="@{'/img/' + ${news_article.comics_url}}" alt="AI ìš”ì•½ ì´ë¯¸ì§€">
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: AI ìš”ì•½ í…ìŠ¤íŠ¸ -->
        <div style="flex: 1;">
            <ol class="ai-summary-list" style="margin: 0; padding-left: 20px;">
                <li th:each="line : ${summaryLines}" th:text="${line}">ìš”ì•½ ë¬¸ì¥</li>
            </ol>
        </div>
    </div>

    <!-- ë‰´ìŠ¤ ì´ë¯¸ì§€ ì¶”ê°€ -->
    <img class="news-img" th:src="${news_article.img_url}" alt="ë‰´ìŠ¤ ì´ë¯¸ì§€">

    <div class="news-content" th:utext="${news_article.content}">
        <!-- ë³¸ë¬¸ ë‚´ìš© -->
    </div>

    <!-- ê°™ì´ ë³´ë©´ ì¢‹ì€ ê¸°ì‚¬ -->
    <div class="section-title">ì—°ê´€ ë‰´ìŠ¤ ì¶”ì²œ</div>
    <div class="related-news-scroll" onwheel="scrollHorizontally(event)">
        <div class="related-news-item" th:each="related : ${related_news_articles}"
             th:href="@{/view/{id}(id=${related.news_article.id})}">
            <a th:href="@{/view/{id}(id=${related.news_article.id})}">
                <img th:src="${related.news_article.img_url}" alt="ê´€ë ¨ ë‰´ìŠ¤ ì´ë¯¸ì§€">
                <div class="title" th:text="${related.news_article.title}">ê´€ë ¨ ë‰´ìŠ¤ ì œëª©</div>
            </a>
        </div>
    </div>
</div>

<!-- ìˆ¨ê²¨ì§„ ë°ì´í„° ì €ì¥ì†Œ (ìƒˆë¡œìš´ êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •) -->
<div id="allContentChecksData" style="display: none;">
    <div th:each="typeEntry : ${news_article.content_checks}">
        <div th:each="keywordEntry : ${typeEntry.value}">
            <div th:each="check : ${keywordEntry.value}"
                 th:attr="data-type=${check.content_check_type}, data-score=${check.score}, data-keyword=${check.keyword}">
            </div>
        </div>
    </div>
</div>

<!-- Title checks í‚¤ì›Œë“œ ì •ë³´ë„ ì €ì¥ -->
<div id="titleChecksData" style="display: none;">
    <div th:each="titleCheck : ${news_article.title_checks}"
         th:attr="data-type=${titleCheck.content_check_type}, data-score=${titleCheck.score}, data-keyword=${titleCheck.keyword}">
    </div>
</div>

<script>
    // íƒ€ì…ëª…ì„ í•œê¸€ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    function getKoreanTypeName(englishType) {
        const typeNames = {
            'title_normal': 'ì •ìƒ í‘œí˜„',
            'title_hidden_1': 'ì˜ë¬¸ ìœ ë°œ(ë¶€í˜¸)',
            'title_hidden_2': 'ì˜ë¬¸ ìœ ë°œ(ì€ë‹‰)',
            'title_sensation': 'ì„ ì • í‘œí˜„',
            'title_slang': 'ì†ì–´/ì¤„ì„ë§ ì‚¬ìš©',
            'title_over_representation': 'ê³¼ëŒ€ í‘œí˜„',
            'title_intentional_distortion': 'ì£¼ì–´ ì˜ë„ì  ì™œê³¡',
            'content_normal': 'ì •ìƒ í‘œí˜„',
            'content_advertisement_1': 'íŒë§¤ì •ë³´ ë…¸ì¶œ(ìƒí’ˆ)',
            'content_advertisement_2': 'íŒë§¤ì •ë³´ ë…¸ì¶œ(ë¶€ë™ì‚°)',
            'content_advertisement_3': 'íŒë§¤ì •ë³´ ë…¸ì¶œ(ì„œë¹„ìŠ¤)',
            'content_intentional_distortion': 'ì˜ë„ì  ìƒí™© ì™œê³¡'
        };

        return typeNames[englishType] || englishType;
    }

    // ìŠ¤í¬ë¡¤ ë”°ë¼ë‹¤ë‹ˆëŠ” ê·¸ë˜í”„ ìœ„ì ¯
    const qualityGraph = document.getElementById('qualityGraph');
    let isScrolling = false;

    window.addEventListener('scroll', () => {
        if (!isScrolling) {
            window.requestAnimationFrame(() => {
                const scrollY = window.scrollY;
                const newTop = 120 + (scrollY * 0.05);
                qualityGraph.style.top = `${newTop}px`;
                isScrolling = false;
            });
        }
        isScrolling = true;
    });

    // ëª¨ë“  Content Checks ë°ì´í„° ì½ê¸° (ìƒˆë¡œìš´ êµ¬ì¡° ëŒ€ì‘)
    function getAllContentChecksData() {
        const dataContainer = document.getElementById('allContentChecksData');
        const allData = [];

        // ëª¨ë“  ì²´í¬ ë°ì´í„° ìˆ˜ì§‘
        const checkElements = dataContainer.querySelectorAll('[data-type][data-score][data-keyword]');

        checkElements.forEach(element => {
            const type = element.getAttribute('data-type');
            const score = parseFloat(element.getAttribute('data-score'));
            const keyword = element.getAttribute('data-keyword');

            allData.push({
                type: type,
                score: score,
                keyword: keyword
            });
        });

        console.log('ì „ì²´ Content Checks ë°ì´í„°:', allData.length, 'ê°œ');
        return allData;
    }

    // **í•µì‹¬ ìˆ˜ì •: í†µì¼ëœ ë¬¸ì œ ë¬¸ì¥ íƒì§€ ë¡œì§**
    function getProblemSentencesForChart() {
        const allData = getAllContentChecksData();

        if (allData.length === 0) {
            return {
                totalSentences: 0,
                problemSentences: 0,
                normalSentences: 0,
                problemsByType: {}
            };
        }

        // content_ íƒ€ì…ë§Œ í•„í„°ë§í•˜ê³  í‚¤ì›Œë“œë³„ë¡œ ê·¸ë£¹í™”
        const keywordGroups = {};
        allData.forEach(item => {
            if (item.type && item.type.startsWith('content_')) {
                if (!keywordGroups[item.keyword]) {
                    keywordGroups[item.keyword] = [];
                }
                keywordGroups[item.keyword].push(item);
            }
        });

        let totalSentences = 0;
        let problemSentences = 0;
        const problemsByType = {};

        // ê° í‚¤ì›Œë“œ(ë¬¸ì¥)ë³„ë¡œ ê°€ì¥ ë†’ì€ ì ìˆ˜ì˜ íƒ€ì… í™•ì¸
        for (const keyword in keywordGroups) {
            const checks = keywordGroups[keyword];
            totalSentences++;

            // ê°€ì¥ ë†’ì€ ì ìˆ˜ì™€ í•´ë‹¹ íƒ€ì… ì°¾ê¸°
            let maxScore = 0;
            let maxType = null;

            checks.forEach(check => {
                if (check.score > maxScore) {
                    maxScore = check.score;
                    maxType = check.type;
                }
            });

            // normalì´ ì•„ë‹ˆê³  ì„ê³„ê°’(0.3) ì´ìƒì´ë©´ ë¬¸ì œ ë¬¸ì¥ìœ¼ë¡œ ë¶„ë¥˜
            if (maxType !== 'content_normal' && maxScore > 0.3) {
                problemSentences++;

                // íƒ€ì…ë³„ë¡œ ë¬¸ì œ ë¬¸ì¥ ì €ì¥
                if (!problemsByType[maxType]) {
                    problemsByType[maxType] = [];
                }
                problemsByType[maxType].push({
                    text: keyword,
                    score: maxScore
                });
            }
        }

        // ê° íƒ€ì…ë³„ë¡œ ì ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
        for (const type in problemsByType) {
            problemsByType[type].sort((a, b) => b.score - a.score);
        }

        const normalSentences = totalSentences - problemSentences;

        console.log(`ë¬¸ì œ íƒì§€ ê²°ê³¼: ì´ ${totalSentences}ê°œ, ë¬¸ì œ ${problemSentences}ê°œ, ì •ìƒ ${normalSentences}ê°œ`);
        console.log('íƒ€ì…ë³„ ë¬¸ì œ ë¬¸ì¥:', problemsByType);

        return {
            totalSentences,
            problemSentences,
            normalSentences,
            problemsByType
        };
    }

    // ë¬¸ì œ ë¬¸ì¥ ë¹„ìœ¨ ê³„ì‚° ë° ë„ë„› ì°¨íŠ¸ ìƒì„±
    function createProblemRatioChart() {
        const result = getProblemSentencesForChart();
        const { totalSentences, problemSentences, normalSentences } = result;

        const problemRatio = totalSentences > 0 ? (problemSentences / totalSentences * 100) : 0;

        console.log(`ì°¨íŠ¸ìš© ë°ì´í„°: ì´ ë¬¸ì¥ ${totalSentences}, ë¬¸ì œ ë¬¸ì¥ ${problemSentences}, ë¹„ìœ¨ ${problemRatio.toFixed(1)}%`);

        // ë„ë„› ì°¨íŠ¸ ìƒì„±
        const canvas = document.getElementById('problemRatioChart');
        if (!canvas) {
            console.log('ìº”ë²„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return result;
        }

        const ctx = canvas.getContext('2d');

        // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 70;
        const innerRadius = 35;

        // ì „ì²´ ì› ë°°ê²½
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
        ctx.fillStyle = '#f0f0f0';
        ctx.fill();

        if (totalSentences > 0) {
            // ë¬¸ì œ ë¬¸ì¥ ë¹„ìœ¨ (ë¹¨ê°„ìƒ‰)
            if (problemSentences > 0) {
                const problemAngle = 2 * Math.PI * (problemSentences / totalSentences);
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, -Math.PI/2, -Math.PI/2 + problemAngle);
                ctx.lineTo(centerX + Math.cos(-Math.PI/2 + problemAngle) * innerRadius,
                          centerY + Math.sin(-Math.PI/2 + problemAngle) * innerRadius);
                ctx.arc(centerX, centerY, innerRadius, -Math.PI/2 + problemAngle, -Math.PI/2, true);
                ctx.closePath();
                ctx.fillStyle = '#ff6b6b';
                ctx.fill();
            }

            // ì •ìƒ ë¬¸ì¥ ë¹„ìœ¨ (íŒŒë€ìƒ‰)
            if (normalSentences > 0) {
                const problemAngle = 2 * Math.PI * (problemSentences / totalSentences);
                const normalAngle = 2 * Math.PI * (normalSentences / totalSentences);
                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, -Math.PI/2 + problemAngle, -Math.PI/2 + problemAngle + normalAngle);
                ctx.lineTo(centerX + Math.cos(-Math.PI/2 + problemAngle + normalAngle) * innerRadius,
                          centerY + Math.sin(-Math.PI/2 + problemAngle + normalAngle) * innerRadius);
                ctx.arc(centerX, centerY, innerRadius, -Math.PI/2 + problemAngle + normalAngle, -Math.PI/2 + problemAngle, true);
                ctx.closePath();
                ctx.fillStyle = '#48dbfb';
                ctx.fill();
            }
        }

        // ë‚´ë¶€ ì› (ë„ë„› êµ¬ë©)
        ctx.beginPath();
        ctx.arc(centerX, centerY, innerRadius, 0, 2 * Math.PI);
        ctx.fillStyle = 'white';
        ctx.fill();

        // ì¤‘ì•™ í…ìŠ¤íŠ¸
        ctx.fillStyle = '#333';
        ctx.font = 'bold 16px Arial';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(`${problemRatio.toFixed(1)}%`, centerX, centerY - 8);
        ctx.font = '11px Arial';
        ctx.fillText('ë¬¸ì œ ë¹„ìœ¨', centerX, centerY + 8);

        // ë²”ë¡€ ì—…ë°ì´íŠ¸
        const legend = document.getElementById('chartLegend');
        if (legend) {
            legend.innerHTML = `
                <div style="display: flex; justify-content: center; gap: 10px;">
                    <div style="display: flex; align-items: center; gap: 3px;">
                        <div style="width: 8px; height: 8px; background: #ff6b6b; border-radius: 50%;"></div>
                        <span>ë¬¸ì œ (${problemSentences})</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 3px;">
                        <div style="width: 8px; height: 8px; background: #48dbfb; border-radius: 50%;"></div>
                        <span>ì •ìƒ (${normalSentences})</span>
                    </div>
                </div>
            `;
        }

        return result;
    }

    // **ìˆ˜ì •ëœ ë³¸ë¬¸ í€„ë¦¬í‹° ë¶„ì„ ëª¨ë‹¬ ì—´ê¸° - ì°¨íŠ¸ì™€ ë™ì¼í•œ ë¡œì§ ì‚¬ìš©**
    function openContentQualityModal() {
        const modal = document.getElementById('contentQualityModal');
        const resultsContainer = document.getElementById('contentQualityResults');

        // ì°¨íŠ¸ì™€ ë™ì¼í•œ ë¡œì§ìœ¼ë¡œ ë¬¸ì œ ë¬¸ì¥ íƒì§€
        const result = getProblemSentencesForChart();
        const { totalSentences, problemSentences, normalSentences, problemsByType } = result;

        let resultHtml = '';

        if (Object.keys(problemsByType).length === 0) {
            resultHtml = `
                <div style="text-align: center; padding: 40px; color: #48dbfb;">
                    <div style="font-size: 48px; margin-bottom: 20px;">âœ…</div>
                    <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">ëª¨ë“  ë¬¸ì¥ì´ ì–‘í˜¸í•©ë‹ˆë‹¤!</div>
                    <div style="font-size: 14px; color: #666;">ë¬¸ì œê°€ ìˆëŠ” ë¬¸ì¥ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>
                    <div style="font-size: 14px; color: #666; margin-top: 10px;">
                        ì´ ${totalSentences}ê°œ ë¬¸ì¥ì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.
                    </div>
                </div>
            `;
        } else {
            const totalProblemCount = Object.values(problemsByType).reduce((sum, arr) => sum + arr.length, 0);

            resultHtml = `
                <div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                    <div style="font-size: 16px; font-weight: bold; color: #1976d2;">
                        ğŸ“Š ê²€ì¶œëœ ë¬¸ì œ ìœ í˜•: ${Object.keys(problemsByType).length}ê°œ
                    </div>
                    <div style="font-size: 14px; color: #666; margin-top: 5px;">
                        ì´ ${totalSentences}ê°œ ë¬¸ì¥ ì¤‘ ${totalProblemCount}ê°œ ë¬¸ì¥ì—ì„œ ë¬¸ì œ ë°œê²¬
                        (${((totalProblemCount / totalSentences) * 100).toFixed(1)}%)
                    </div>
                </div>
            `;

            // íƒ€ì…ë³„ë¡œ ë¬¸ì œ ë¬¸ì¥ë“¤ í‘œì‹œ
            for (const type in problemsByType) {
                const sentences = problemsByType[type];
                const typeInfo = checkDescriptions[type] || { title: type };

                resultHtml += `
                    <div class="type-group">
                        <div class="type-group-header">
                            ${typeInfo.title} (${sentences.length}ê°œ ë¬¸ì¥)
                        </div>
                        <div class="type-group-content">
                `;

                sentences.forEach((sentence, index) => {
                    const shortText = sentence.text.length > 200 ?
                        sentence.text.substring(0, 200) + '...' :
                        sentence.text;

                    resultHtml += `
                        <div class="problem-sentence-item">
                            <div class="sentence-score">ìœ„í—˜ë„: ${sentence.score.toFixed(6)}</div>
                            <div class="sentence-text">"${shortText}"</div>
                        </div>
                    `;
                });

                resultHtml += `
                        </div>
                    </div>
                `;
            }
        }

        resultsContainer.innerHTML = resultHtml;
        modal.style.display = 'block';
    }

    // ë³¸ë¬¸ í€„ë¦¬í‹° ë¶„ì„ ëª¨ë‹¬ ë‹«ê¸°
    function closeContentQualityModal() {
        document.getElementById('contentQualityModal').style.display = 'none';
    }

    // Content Checks ê·¸ë˜í”„ ë Œë”ë§ (ë„ë„› ì°¨íŠ¸ë§Œ)
    function renderContentChecks() {
        // ë„ë„› ì°¨íŠ¸ ìƒì„± ë° ê²°ê³¼ ë°˜í™˜
        const result = createProblemRatioChart();
        console.log('ë Œë”ë§ ì™„ë£Œ:', result);
        return result;
    }

    // **ê¸°ì¡´ í•¨ìˆ˜ëŠ” í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€í•˜ë˜ ìƒˆë¡œìš´ í†µí•© í•¨ìˆ˜ ì‚¬ìš©**
    function getProblemSentences(checkType) {
        // ìƒˆë¡œìš´ í†µí•© ë¡œì§ ì‚¬ìš©
        const result = getProblemSentencesForChart();
        const problemsByType = result.problemsByType;

        if (problemsByType[checkType]) {
            return problemsByType[checkType];
        }

        return [];
    }

    // ê²€ì‚¬ íƒ€ì…ë³„ ìƒì„¸ ì„¤ëª… (ëª¨ë“  íƒ€ì… í¬í•¨)
    const checkDescriptions = {
        // ì œëª© ê´€ë ¨
        'title_normal': {
            title: 'ì •ìƒ í‘œí˜„',
            description: 'ì œëª©ì´ ê³¼ë„í•˜ê²Œ ìê·¹ì ì´ê±°ë‚˜ ì„ ì •ì ì´ì§€ ì•Šê³ , ì¼ë°˜ì ì´ê³  ê°ê´€ì ì¸ í‘œí˜„ì„ ì‚¬ìš©í•˜ëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'title_hidden_1': {
            title: 'ì˜ë¬¸ ìœ ë°œ(ë¶€í˜¸)',
            description: 'ì œëª©ì— ì˜ë¬¸ì„ ìœ ë°œí•˜ëŠ” ë¶€í˜¸ë‚˜ í‘œí˜„ì´ ì‚¬ìš©ë˜ì–´ ë…ìì˜ í˜¸ê¸°ì‹¬ì„ ìê·¹í•˜ëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤. ì˜ˆ: "ì†í¥ë¯¼ ìš°ìŠ¹ì˜ ë¹„ê²°ì€ ë°”ë¡œ ì´ê²ƒ!"'
        },
        'title_hidden_2': {
            title: 'ì˜ë¬¸ ìœ ë°œ(ì€ë‹‰)',
            description: 'ì œëª©ì—ì„œ í•µì‹¬ ë‚´ìš©ì„ ì˜ë„ì ìœ¼ë¡œ ìˆ¨ê²¨ ë…ìì˜ í˜¸ê¸°ì‹¬ì„ ìê·¹í•˜ëŠ” í‘œí˜„ì´ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'title_sensation': {
            title: 'ì„ ì • í‘œí˜„',
            description: 'ì œëª©ì— ë…ìì˜ ê´€ì‹¬ì„ ëŒê¸° ìœ„í•œ ì„ ì •ì ì´ê±°ë‚˜ ìê·¹ì ì¸ í‘œí˜„ì´ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤. ì˜ˆ: "ì¶©ê²© ê³ ë°±! í†±ìŠ¤íƒ€ A, 10ë…„ê°„ ìˆ¨ê²¨ì˜¨ ë¹„ë°€ ì—°ì•  ì „ê²© ê³µê°œ"'
        },
        'title_slang': {
            title: 'ì†ì–´/ì¤„ì„ë§ ì‚¬ìš©',
            description: 'ì œëª©ì— ë¶€ì ì ˆí•œ ì†ì–´, ì€ì–´, ì¤„ì„ë§ ë˜ëŠ” ê²©ì‹ì— ë§ì§€ ì•ŠëŠ” í‘œí˜„ì´ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤. ì˜ˆ: "í•œí™” T1 ìƒëŒ€ë¡œ ìŠ¹ë¦¬! ì§€ë ¸ë‹¤!"'
        },
        'title_over_representation': {
            title: 'ê³¼ëŒ€ í‘œí˜„',
            description: 'ì œëª©ì— ê³¼ì¥ë˜ê±°ë‚˜ ê³¼ë„í•œ í‘œí˜„ì´ ì‚¬ìš©ë˜ì–´ ì‹¤ì œë³´ë‹¤ ë¶€í’€ë ¤ì„œ í‘œí˜„ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤. ì˜ˆ: "í•œêµ­ ë¡œë˜ê°€ ìˆ¨ê¸´ ë‹¹ì²¨ì˜ ë¹„ë°€, ë¡œë˜ ì—…ê³„ì—ì„œ ë¹„ë°€ ë°í˜€ì ¸.. ì—…ê³„ ë¹„ìƒ!"'
        },
        'title_intentional_distortion': {
            title: 'ì£¼ì–´ ì˜ë„ì  ì™œê³¡(ì£¼ì–´ ìˆ¨ê¹€)',
            description: 'ì œëª©ì—ì„œ ì£¼ì–´ë¥¼ ì˜ë„ì ìœ¼ë¡œ ìˆ¨ê¸°ê±°ë‚˜ ì™œê³¡í•˜ì—¬ ì˜¤í•´ë¥¼ ë¶ˆëŸ¬ì¼ìœ¼í‚¬ ìˆ˜ ìˆëŠ” í‘œí˜„ì„ ì‚¬ìš©í•˜ëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤. ì˜ˆ: "ìœ¤ ëŒ€í†µë ¹ì˜ ì„ íƒì€? ì§€ëª… ë§‰ë°”ì§€ë¡œ ì ‘ì–´ë“¤ì–´..."'
        },

        // ë‚´ìš© ê´€ë ¨
        'content_normal': {
            title: 'ì •ìƒ í‘œí˜„',
            description: 'ê¸°ì‚¬ ë‚´ìš©ì´ ê°ê´€ì ì´ê³  ê· í˜• ì¡íŒ ì‹œê°ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'content_advertisement_1': {
            title: 'íŒë§¤ì •ë³´ ë…¸ì¶œ(ìƒí’ˆ íŒë§¤ì •ë³´)',
            description: 'ê¸°ì‚¬ ë‚´ìš©ì— ìƒí’ˆ íŒë§¤ë¥¼ ëª©ì ìœ¼ë¡œ í•˜ëŠ” ê´‘ê³ ì„± ë‚´ìš©ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤. ì˜ˆ: íŠ¹ì • ìƒí’ˆì´ë‚˜ ì„œë¹„ìŠ¤ì˜ íŒë§¤ ì •ë³´ê°€ ê¸°ì‚¬ì— ì€ë°€í•˜ê²Œ í¬í•¨ëœ ê²½ìš°'
        },
        'content_advertisement_2': {
            title: 'íŒë§¤ì •ë³´ ë…¸ì¶œ(ë¶€ë™ì‚° íŒë§¤ì •ë³´)',
            description: 'ê¸°ì‚¬ ë‚´ìš©ì— ë¶€ë™ì‚° íŒë§¤ë‚˜ íˆ¬ìë¥¼ ëª©ì ìœ¼ë¡œ í•˜ëŠ” ê´‘ê³ ì„± ë‚´ìš©ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'content_advertisement_3': {
            title: 'íŒë§¤ì •ë³´ ë…¸ì¶œ(ì„œë¹„ìŠ¤ íŒë§¤ì •ë³´)',
            description: 'ê¸°ì‚¬ ë‚´ìš©ì— ì„œë¹„ìŠ¤ íŒë§¤ë‚˜ í™ë³´ë¥¼ ëª©ì ìœ¼ë¡œ í•˜ëŠ” ê´‘ê³ ì„± ë‚´ìš©ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        },
        'content_intentional_distortion': {
            title: 'ì˜ë„ì  ìƒí™© ì™œê³¡',
            description: 'ê¸°ì‚¬ ë‚´ìš©ì—ì„œ ì‹¤ì œ ìƒí™©ì„ ì˜ë„ì ìœ¼ë¡œ ì™œê³¡í•˜ê±°ë‚˜ í¸í–¥ëœ ì‹œê°ìœ¼ë¡œ ì„œìˆ í•˜ì—¬ ë…ìì—ê²Œ ì˜ëª»ëœ ì¸ì‹ì„ ì‹¬ì–´ì¤„ ìˆ˜ ìˆëŠ”ì§€ ê²€ì‚¬í•©ë‹ˆë‹¤.'
        }
    };

    // í•´ë‹¹ íƒ€ì…ì˜ ì‹¤ì œ í‚¤ì›Œë“œë“¤ ì°¾ê¸° (ìƒˆë¡œìš´ êµ¬ì¡° ëŒ€ì‘)
    function findActualKeywords(checkType, type) {
        const keywords = [];

        if (type === 'title') {
            // Title checksì—ì„œ í•´ë‹¹ íƒ€ì…ì˜ í‚¤ì›Œë“œ ì°¾ê¸°
            const titleDataContainer = document.getElementById('titleChecksData');
            const titleElements = titleDataContainer.querySelectorAll(`[data-type="${checkType}"]`);

            titleElements.forEach(element => {
                const keyword = element.getAttribute('data-keyword');
                const score = element.getAttribute('data-score');
                if (keyword && keyword.trim() !== '') {
                    keywords.push({
                        text: keyword,
                        score: parseFloat(score)
                    });
                }
            });
        } else if (type === 'content') {
            // Content checksì—ì„œ í•´ë‹¹ íƒ€ì…ì˜ í‚¤ì›Œë“œë“¤ ì°¾ê¸°
            const allData = getAllContentChecksData();

            // í•´ë‹¹ íƒ€ì…ì˜ ë°ì´í„°ë§Œ í•„í„°ë§
            const typeData = allData.filter(item => item.type === checkType);

            typeData.forEach(item => {
                if (item.keyword && item.keyword.trim() !== '') {
                    keywords.push({
                        text: item.keyword,
                        score: item.score
                    });
                }
            });
        }

        // ì ìˆ˜ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬
        keywords.sort((a, b) => b.score - a.score);

        return keywords;
    }

    // ëª¨ë‹¬ ì—´ê¸° (ì‹¤ì œ í‚¤ì›Œë“œ í‘œì‹œ)
    function openDetailModal(element, type) {
        const checkType = element.getAttribute('data-type');
        const score = parseFloat(element.getAttribute('data-score'));
        const count = element.getAttribute('data-count');

        const modal = document.getElementById('detailModal');
        const title = document.getElementById('detailTitle');
        const scoreElement = document.getElementById('detailScore');
        const description = document.getElementById('detailDescription');
        const keywordsDiv = document.getElementById('detailKeywords');
        const keywordContent = document.getElementById('keywordContent');

        const checkInfo = checkDescriptions[checkType] || {
            title: 'ê²€ì‚¬ í•­ëª©',
            description: 'í•´ë‹¹ ê²€ì‚¬ í•­ëª©ì— ëŒ€í•œ ìƒì„¸ ì„¤ëª…ì…ë‹ˆë‹¤.'
        };

        title.textContent = `${type === 'title' ? 'ì œëª©' : 'ë‚´ìš©'} - ${checkInfo.title}`;

        if (type === 'content' && count) {
            scoreElement.textContent = `í‰ê·  ìœ„í—˜ë„: ${score.toFixed(6)} (${count}ê°œ ë°ì´í„°)`;
        } else {
            scoreElement.textContent = `ìœ„í—˜ë„ ì ìˆ˜: ${score.toFixed(6)}`;
        }

        // ì ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ì„¤ì •
        const isNormalType = checkType.includes('normal');
        if (isNormalType) {
            if (score >= 0.7) {
                scoreElement.style.background = 'linear-gradient(135deg, #48dbfb, #0abde3)';
            } else if (score >= 0.4) {
                scoreElement.style.background = 'linear-gradient(135deg, #feca57, #ffd93d)';
            } else {
                scoreElement.style.background = 'linear-gradient(135deg, #ff6b6b, #ff8e8e)';
            }
        } else {
            if (score >= 0.7) {
                scoreElement.style.background = 'linear-gradient(135deg, #ff6b6b, #ff8e8e)';
            } else if (score >= 0.4) {
                scoreElement.style.background = 'linear-gradient(135deg, #feca57, #ffd93d)';
            } else {
                scoreElement.style.background = 'linear-gradient(135deg, #48dbfb, #0abde3)';
            }
        }

        // ì„¤ëª…ê³¼ í•´ì„ ì¶”ê°€
        let interpretation = '';
        if (isNormalType) {
            if (score >= 0.7) {
                interpretation = '<br><br><strong style="color: #48dbfb;">âœ… ìš°ìˆ˜: ë§¤ìš° ì–‘í˜¸í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.</strong><br>ì´ í•­ëª©ì—ì„œ ë†’ì€ ì ìˆ˜ê°€ ë‚˜ì˜¨ ê²ƒì€ ê¸°ì‚¬ì˜ í’ˆì§ˆì´ ìš°ìˆ˜í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.';
            } else if (score >= 0.4) {
                interpretation = '<br><br><strong style="color: #feca57;">âš ï¸ ë³´í†µ: ê°œì„  ì—¬ì§€ê°€ ìˆëŠ” ìˆ˜ì¤€ì…ë‹ˆë‹¤.</strong><br>ê¸°ë³¸ì ì¸ í’ˆì§ˆì€ ê°–ì¶”ê³  ìˆì§€ë§Œ ë” ë‚˜ì€ í’ˆì§ˆì„ ìœ„í•´ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.';
            } else {
                interpretation = '<br><br><strong style="color: #ff6b6b;">ğŸš¨ ì£¼ì˜: í’ˆì§ˆ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.</strong><br>ì´ í•­ëª©ì—ì„œ ë‚®ì€ ì ìˆ˜ê°€ ë‚˜ì˜¨ ê²ƒì€ í’ˆì§ˆ í–¥ìƒì´ í•„ìš”í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.';
            }
        } else {
            if (score >= 0.7) {
                interpretation = '<br><br><strong style="color: #ff6b6b;">ğŸš¨ ìœ„í—˜: ì¦‰ì‹œ ê²€í† ê°€ í•„ìš”í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.</strong><br>ì´ í•­ëª©ì—ì„œ ë†’ì€ ì ìˆ˜ê°€ ë‚˜ì™”ë‹¤ëŠ” ê²ƒì€ í•´ë‹¹ ë¶€ë¶„ì— ë¬¸ì œê°€ ìˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.';
            } else if (score >= 0.4) {
                interpretation = '<br><br><strong style="color: #feca57;">âš ï¸ ì£¼ì˜: ê°œì„ ì´ ê¶Œì¥ë˜ëŠ” ìˆ˜ì¤€ì…ë‹ˆë‹¤.</strong><br>ì™„ì „íˆ ë¬¸ì œê°€ ìˆë‹¤ê³  ë³¼ ìˆ˜ëŠ” ì—†ì§€ë§Œ, ë” ë‚˜ì€ í’ˆì§ˆì„ ìœ„í•´ ê²€í† í•´ë³¼ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.';
            } else {
                interpretation = '<br><br><strong style="color: #48dbfb;">âœ… ì–‘í˜¸: í’ˆì§ˆì´ ìš°ìˆ˜í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.</strong><br>ì´ í•­ëª©ì—ì„œëŠ” íŠ¹ë³„í•œ ë¬¸ì œê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
            }
        }

        description.innerHTML = checkInfo.description + interpretation;

        // ì‹¤ì œ í‚¤ì›Œë“œë“¤ í‘œì‹œ (ë¬¸ì œ ë¬¸ì¥ë§Œ í•„í„°ë§)
        if (type === 'content') {
            const problemSentences = getProblemSentences(checkType);

            if (problemSentences.length > 0) {
                let keywordHtml = `<div style="font-size: 12px; color: #666; margin-bottom: 10px;">ë¬¸ì œê°€ ìˆëŠ” ë¬¸ì¥: ${problemSentences.length}ê°œ</div>`;

                problemSentences.forEach((item, index) => {
                    const shortText = item.text.length > 150 ?
                        item.text.substring(0, 150) + '...' :
                        item.text;

                    keywordHtml += `
                        <div class="example-sentence problem-sentence">
                            <div style="font-size: 12px; color: #c62828; margin-bottom: 5px; font-weight: bold;">
                                ìœ„í—˜ë„: ${item.score.toFixed(6)}
                            </div>
                            <div style="line-height: 1.4;">
                                "${shortText}"
                            </div>
                        </div>
                    `;
                });

                keywordContent.innerHTML = keywordHtml;
                keywordsDiv.style.display = 'block';
            } else {
                keywordContent.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">ì´ íƒ€ì…ì—ì„œ ë¬¸ì œê°€ ìˆëŠ” ë¬¸ì¥ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>';
                keywordsDiv.style.display = 'block';
            }
        } else {
            // Title checksëŠ” ê¸°ì¡´ ë°©ì‹ ìœ ì§€
            const actualKeywords = findActualKeywords(checkType, type);
            if (actualKeywords.length > 0) {
                let keywordHtml = '';

                const displayKeywords = actualKeywords.slice(0, 5);

                displayKeywords.forEach((item, index) => {
                    const shortText = item.text.length > 100 ?
                        item.text.substring(0, 100) + '...' :
                        item.text;

                    keywordHtml += `
                        <div class="example-sentence">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
                                ì ìˆ˜: ${item.score.toFixed(6)}
                            </div>
                            <div style="line-height: 1.4;">
                                "${shortText}"
                            </div>
                        </div>
                    `;
                });

                if (actualKeywords.length > 5) {
                    keywordHtml += `<div style="font-size: 12px; color: #999; text-align: center; margin-top: 10px;">ì™¸ ${actualKeywords.length - 5}ê°œ ë”...</div>`;
                }

                keywordContent.innerHTML = keywordHtml;
                keywordsDiv.style.display = 'block';
            } else {
                keywordsDiv.style.display = 'none';
            }
        }

        modal.style.display = 'block';
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeDetailModal() {
        document.getElementById('detailModal').style.display = 'none';
    }

    // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    window.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            closeDetailModal();
            closeContentQualityModal();
        }
    });

    // ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        const detailModal = document.getElementById("detailModal");
        const contentQualityModal = document.getElementById("contentQualityModal");
        if (event.target === detailModal) {
            closeDetailModal();
        }
        if (event.target === contentQualityModal) {
            closeContentQualityModal();
        }
    }

    // ê°€ë¡œ ìŠ¤í¬ë¡¤ í•¨ìˆ˜
    function scrollHorizontally(event) {
        event.preventDefault();
        event.currentTarget.scrollLeft += event.deltaY;
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ Content Checks ë Œë”ë§
    window.addEventListener('load', function() {
        console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - ë„ë„› ì°¨íŠ¸ ë²„ì „');

        // Content Checks ë„ë„› ì°¨íŠ¸ ìƒì„±
        renderContentChecks();

        // ê·¸ë˜í”„ ì• ë‹ˆë©”ì´ì…˜
        setTimeout(() => {
            const barFills = document.querySelectorAll('.bar-fill');
            barFills.forEach((bar, index) => {
                setTimeout(() => {
                    bar.style.width = bar.style.width; // ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°
                }, index * 200);
            });
        }, 100);
    });
</script>

</body>
</html>