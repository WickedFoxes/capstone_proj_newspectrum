<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:inline="javascript">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î©îÏù∏ÌéòÏù¥ÏßÄ</title>

    <!-- Ïô∏Î∂Ä Ïä§ÌÉÄÏùº/Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <link rel="stylesheet" th:href="@{/css/header.css}">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-cloud/1.2.5/d3.layout.cloud.min.js"></script>

    <style>
        /* Ïä¨ÎùºÏù¥Îçî Ïª®ÌÖåÏù¥ÎÑà */
        body {
            font-family: Arial, sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 0;
        }

        .slider-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            margin-top: 30px;
            transition: transform 0.5s ease;
        }
        .wordcloud-box {
            width: 45%;
            height: 500px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 10px;
        }
        .news-list-container {
            width: 45%;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 20px;
            display: none;
        }
        .news-list-container.show {
            display: block;
        }
        .news-item {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            cursor: pointer;
        }
        .news-item img {
            width: 100px;
            height: 70px;
            object-fit: cover;
            margin-right: 16px;
            border-radius: 4px;
        }
        .news-item-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }
        .news-item-media {
            font-size: 12px;
            color: #999;
        }
        .domain-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .wordcloud-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-top: 30px;
        }

        .wordcloud-box {
            width: 520px;
            height: 520px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 10px;
            position: relative;
            z-index: 1;
        }

        .arrow {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 50%;
            margin: 0 10px;
            z-index: 2;
            transition: background-color 0.3s ease;
        }

        .arrow:hover {
            background-color: #0056b3;
        }
        .pagination-buttons {
            text-align: center;
            margin-top: 20px;
        }

        .pagination-buttons button {
            padding: 8px 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            margin: 0 5px;
            cursor: pointer;
        }

        .pagination-buttons button:disabled {
            background-color: #cccccc;
            cursor: default;
        }

        /*Ìï´Ïù¥Ïäà ÏûêÎèô Ïä¨ÎùºÏù¥Îìú*/
        .news-slider-wrapper {
            width: 100%;
            overflow: hidden;
            position: relative;
            max-width: 1200px;
            margin: auto;
        }

        .news-slider-track {
            display: flex;
            transition: transform 0.5s ease-in-out;
            width: 100%;
        }

        .news-main-container {
            flex: 0 0 100%;
            box-sizing: border-box;
        }

        .news-main-container {
            display: flex;
            gap: 30px;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .news-left {
            width: 65%;
        }

        .news-left img {
            width: 100%;
            aspect-ratio: 16 / 9;
            object-fit: cover;
            border-radius: 8px;
        }

        .news-left h2 {
            font-size: 20px;
            font-weight: bold;
            margin-top: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .news-right {
            width: 35%;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .thumbnail-news {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0; /* Íµ¨Î∂ÑÏÑ† Ï∂îÍ∞Ä */
        }

        .thumbnail-news:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .thumbnail-news img {
            width: 100px;
            height: 75px;
            object-fit: cover;
            border-radius: 4px;
        }

        .thumbnail-news p {
            font-size: 14px;
            font-weight: bold;
            color: #111;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin: 0;
        }

        .news-headlines {
            list-style: none;
            padding-left: 0;
            margin-top: 20px;
        }

        .news-headlines li {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px solid #e0e0e0; /* ÏñáÏùÄ ÌöåÏÉâ ÏÑ† */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .news-headlines li:last-child {
            border-bottom: none;
        }


    </style>
</head>
<body>

<!-- ‚úÖ Í≥µÌÜµ ÏÉÅÎã®Î∞î ÏÇΩÏûÖ -->
<div th:replace="layout/common/header :: header"></div>

<!--<div>-->
<!--    <p th:text="${today_issues[0].keywords}">ÌÇ§ÏõåÎìú ÎîîÎ≤ÑÍ∑∏</p>-->
<!--</div>-->

<!--<div class="domain-nav">-->
<!--    <button onclick="prevDomain()">Ïù¥Ï†Ñ</button>-->
<!--    <span id="domainTitle" class="domain-title">Ï†ïÏπò</span>-->
<!--    <button onclick="nextDomain()">Îã§Ïùå</button>-->
<!--</div>-->

<!--Ïò§ÎäòÏùò Ïù¥Ïäà ÏûêÎèô Ïä¨ÎùºÏù¥Îìú-->
<!-- Ïä¨ÎùºÏù¥Îçî Ï†ÑÏ≤¥ ÏòÅÏó≠ -->
<div class="news-slider-wrapper">
    <div class="news-slider-track" id="newsSliderTrack">
        <div class="news-main-container" th:each="issue : ${hotIssues}">
            <!-- üîΩ Í∏∞Ï°¥ news-main-container ÎÇ¥Ïö© (ÏôºÏ™Ω + Ïò§Î•∏Ï™Ω UI) Ïó¨Í∏∞Ïóê Ìè¨Ìï®Îê® -->
            <div class="news-left" th:onclick="|window.location.href='/view/${issue.news_articles[0].id}'|" style="cursor: pointer;">
                <img th:src="@{${issue.news_articles[0].img_url}}" />
                <h2 th:text="${issue.news_articles[0].title}"></h2>
            </div>
            <div class="news-right">
                <div class="thumbnail-news" th:each="news, iter : ${issue.news_articles}"
                     th:if="${iter.index > 0 and iter.index <= 3}"
                     th:onclick="|window.location.href='/view/${news.id}'|"
                     style="cursor: pointer;">
                    <img th:src="@{${news.img_url}}" />
                    <p th:text="${#strings.abbreviate(news.title, 50)}"></p>
                </div>
                <ul class="news-headlines">
                    <li th:each="news, iter : ${issue.news_articles}"
                        th:if="${iter.index >= 4 and iter.index < 8}"
                        th:text="${#strings.abbreviate(news.title, 60)}"
                        th:onclick="|window.location.href='/view/${news.id}'|"
                        style="cursor: pointer;"></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!--AI ÎßåÌèâ Ïπ¥Îìú Îâ¥Ïä§ ÌòïÌÉú-->

<!--ÏõåÎìú ÌÅ¥ÎùºÏö∞Îìú ÌòïÌÉúÏùò Ïò§ÎäòÏùò ÌÇ§ÏõåÎìú-->
<div class="wordcloud-container">
    <button class="arrow left" onclick="prevDomain()">&lt;</button>

    <div>
        <!-- Î™á Î≤àÏß∏ ÏõåÎìú ÌÅ¥ÎùºÏö∞Îìú ÏÉÅÌÉú ÌÖçÏä§Ìä∏ -->
        <div class="wordcloud-status" style="text-align:center; font-size:18px; font-weight:bold; margin-bottom: 10px;">
            <span id="currentDomainText"></span> |
            <span id="currentIndexText"></span>
        </div>

        <div id="wordCloudSlide" class="wordcloud-box"></div>
    </div>

    <button class="arrow right" onclick="nextDomain()">&gt;</button>

    <div id="newsListContainer" class="news-list-container">
        <div id="selectedKeywordTitle" style="font-size: 18px; font-weight: bold; margin-bottom: 15px;"></div>
    </div>
</div>

<!--<p th:text="${issuesByDomainJson}"></p>-->

<script th:inline="javascript">
<!--    Ïò§ÎäòÏùò Ïù¥Ïäà ÏûêÎèô Ïä¨ÎùºÏù¥Îìú-->
    let currentSlide = 0;
    const slideIntervalTime = 5000; // 5Ï¥à
    const slider = document.getElementById("newsSliderTrack");
    const slides = document.querySelectorAll(".news-main-container");
    const totalSlides = slides.length;
    let slideInterval = null;
    let resumeTimeout = null;

    function moveSlide(index) {
        const offset = -index * 100;
        slider.style.transform = `translateX(${offset}%)`;
    }

    function startAutoSlide() {
        slideInterval = setInterval(() => {
            currentSlide = (currentSlide + 1) % totalSlides;
            moveSlide(currentSlide);
        }, slideIntervalTime);
    }

    function stopAutoSlide() {
        clearInterval(slideInterval);
        slideInterval = null;
    }

    function delayRestartAutoSlide() {
        if (resumeTimeout) clearTimeout(resumeTimeout);
        resumeTimeout = setTimeout(() => {
            startAutoSlide();
        }, slideIntervalTime); // 3Ï¥à ÌõÑ Ïû¨ÏãúÏûë
    }

    // Ï¥àÍ∏∞ Ïä¨ÎùºÏù¥Îìú ÏãúÏûë
    startAutoSlide();

    // ÎßàÏö∞Ïä§ Ïù¥Î≤§Ìä∏ Í∞êÏßÄ
    const container = document.querySelector(".news-slider-wrapper");
    container.addEventListener("mouseenter", () => {
        stopAutoSlide();
        if (resumeTimeout) clearTimeout(resumeTimeout);
    });

    container.addEventListener("mouseleave", () => {
        delayRestartAutoSlide();
    });

<!--    ÏõåÎìú ÌÅ¥ÎùºÏö∞Îìú-->
    const issuesByDomain = [[${issuesByDomainJson}]];
    const domains = ["Ï†ïÏπò", "Í≤ΩÏ†ú", "ÏÇ¨Ìöå", "Ïó∞Ïòà", "Ïä§Ìè¨Ï∏†"];
    let currentIndex = 0;
    let currentPage = 0;
    let currentKeyword = '';
    const pageSize = 5;
    let keywordNewsMap = {};

    const wordCloudSlide = d3.select("#wordCloudSlide");
    const newsListContainer = document.getElementById("newsListContainer");

    function renderWordCloud(domain) {
        const domainData = issuesByDomain[domain];
        const words = [];
        keywordNewsMap = {};
        currentPage = 0;

        domainData.main_block_top_keywords.forEach(keywordBlock => {
            const keyword = keywordBlock.keyword;
            const articles = keywordBlock.news_articles;

            words.push({ text: keyword, count: articles.length });
            keywordNewsMap[keyword] = articles;
        });

        const maxCount = Math.max(...words.map(w => w.count));
        const minCount = Math.min(...words.map(w => w.count));

        const normalizedWords = words.map(w => ({
            text: w.text,
            size: ((w.count - minCount) / (maxCount - minCount)) * 55 + 30
        }));

        const topWords = normalizedWords.sort((a, b) => b.size - a.size).slice(0, 40);

        d3.select("#wordCloudSlide svg").remove();

        const layout = d3.layout.cloud()
            .size([520, 520])
            .words(topWords)
            .padding(5)
            .rotate(() => 0)
//            .spiral("archimedean")
            .font("Impact")
            .fontSize(d => d.size)
            .on("end", function(words) {
                draw(words);
            });

        layout.start();

        function draw(words) {
            const containerWidth = document.getElementById("wordCloudSlide").clientWidth;
            const containerHeight = document.getElementById("wordCloudSlide").clientHeight;

            // ÌÇ§ÏõåÎìú ÎπàÎèÑ Í∏∞Ï§Ä Ï†ïÎ†¨
            const sortedWords = [...words].sort((a, b) => b.size - a.size);
            const total = sortedWords.length;
            const topThird = Math.floor(total / 3);
            const middleThird = Math.floor((total * 2) / 3);

            d3.select("#wordCloudSlide svg").remove(); // Í∏∞Ï°¥ ÌÅ¥ÎùºÏö∞Îìú Ï†úÍ±∞

            const svg = d3.select("#wordCloudSlide").append("svg")
                .attr("width", containerWidth)
                .attr("height", containerHeight)
                .append("g")
                .attr("transform", `translate(${containerWidth / 2}, ${containerHeight / 2})`);

            svg.selectAll("text")
                .data(words)
                .enter().append("text")
                .attr("class", "word")
                .style("font-size", d => d.size + "px")
                .style("font-family", "'Segoe UI Semibold', 'Arial', sans-serif") // ÏûêÏó∞Ïä§Îü¨Ïö¥ ÎëêÍªò
                .style("font-weight", "600") // ÎÑàÎ¨¥ ÍµµÏßÄ ÏïäÍ≤å
                .style("fill", d => {
                    const rank = sortedWords.findIndex(w => w.text === d.text);
                    if (rank < topThird) return "#FF7F0E";       // ÏÉÅÏúÑ: Ï£ºÌô©
                    else if (rank < middleThird) return "#1F77B4"; // Ï§ëÏúÑ: ÌååÎûë
                    else return "#A6A6A6";                         // ÌïòÏúÑ: ÌöåÏÉâ
                })
                .attr("text-anchor", "middle")
                .attr("transform", d => "translate(" + [d.x, d.y] + ")")
                .text(d => d.text);

            // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ïó∞Í≤∞
            $("#wordCloudSlide text").on("click", function () {
                const keyword = d3.select(this).text();
                currentKeyword = keyword;
                currentPage = 0;
                showPaginatedNews(currentPage);
            });
        }
        clearNews();
    }

    function clearNews() {
        newsListContainer.innerHTML = "";
        newsListContainer.classList.remove("show");
    }

    function showPaginatedNews(page) {
        newsListContainer.innerHTML = "";
        newsListContainer.classList.add("show");

        // ÏÑ†ÌÉùÎêú ÌÇ§ÏõåÎìú Ï†úÎ™© ÌëúÏãú
        const titleDiv = document.createElement("div");
        titleDiv.id = "selectedKeywordTitle";
        titleDiv.textContent = `üîç ÏÑ†ÌÉùÎêú ÌÇ§ÏõåÎìú: ${currentKeyword}`;
        titleDiv.style.fontSize = "18px";
        titleDiv.style.fontWeight = "bold";
        titleDiv.style.marginBottom = "15px";
        newsListContainer.appendChild(titleDiv);

        const articles = keywordNewsMap[currentKeyword] || [];
        const startIdx = page * pageSize;
        const endIdx = startIdx + pageSize;
        const paginatedNews = articles.slice(startIdx, endIdx);

        paginatedNews.forEach(news => {
            const item = document.createElement("div");
            item.className = "news-item";
            item.onclick = () => window.location.href = '/view/' + news.id;

            item.innerHTML = `
                <img src="${news.img_url}" alt="Îâ¥Ïä§ Ïù¥ÎØ∏ÏßÄ">
                <div class="news-item-content">
                    <div class="news-item-title">${news.title}</div>
                    <div class="news-item-media">${news.media}</div>
                </div>
            `;
            newsListContainer.appendChild(item);
        });

        renderPaginationButtons(articles);
    }

    function renderPaginationButtons(articles) {
        const paginationDiv = document.createElement("div");
        paginationDiv.className = "pagination-buttons";

        const prevBtn = document.createElement("button");
        prevBtn.textContent = "Ïù¥Ï†Ñ";
        prevBtn.disabled = currentPage === 0;
        prevBtn.onclick = () => {
            currentPage--;
            showPaginatedNews(currentPage);
        };

        const nextBtn = document.createElement("button");
        nextBtn.textContent = "Îã§Ïùå";
        nextBtn.disabled = (currentPage + 1) * pageSize >= articles.length;
        nextBtn.onclick = () => {
            currentPage++;
            showPaginatedNews(currentPage);
        };

        paginationDiv.appendChild(prevBtn);
        paginationDiv.appendChild(nextBtn);
        newsListContainer.appendChild(paginationDiv);
    }

    function updateStatusText() {
        document.getElementById("currentDomainText").textContent = "Î∂ÑÏïº: " + domains[currentIndex];
        document.getElementById("currentIndexText").textContent = (currentIndex + 1) + " / " + domains.length;
    }

    function nextDomain() {
        currentIndex = (currentIndex + 1) % domains.length;
        renderWordCloud(domains[currentIndex]);
        updateStatusText();
    }

    function prevDomain() {
        currentIndex = (currentIndex - 1 + domains.length) % domains.length;
        renderWordCloud(domains[currentIndex]);
        updateStatusText();
    }

    renderWordCloud(domains[currentIndex]);
    updateStatusText();
</script>
</body>
</html>